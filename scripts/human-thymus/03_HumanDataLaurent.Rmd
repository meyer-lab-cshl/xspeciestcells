---
title: "Human data"
output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
---

```{r, include=FALSE}
knitr::opts_chunk$set(root.dir = "~/Projects/20220809_Thymic-iNKT-CrossSpecies/scripts/human-thymus/")
```


## 1. Import

```{r import-librairies, message=FALSE}
# Libraries
library(ggplot2)
library(cowplot)
library(Seurat)
library(SeuratWrappers)
# library(harmony)
library(tidyverse)
```

```{r import-data}
# Import data
seur.human <- readRDS("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/raw_data/human_data/filtered_seurat_Harmony_07-22-22.RDS")

# Take quick peek at the data
print(seur.human) # 79,801 cells and 34,778 genes
seur.human@meta.data
```



## 2. UMAP

```{r all-data}
# Color by cell identity
DimPlot(seur.human, pt.size = 0.1, label = F, split.by="group.ident", ncol=3) +
  theme_bw() +
  theme(legend.position="none")
ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/00_HumanData/umap_all_cells.jpeg", width=8, height=10)

# CD4 Thymus
a <- DimPlot(seur.human, pt.size = 0.1, label = F, cells.highlight=WhichCells(seur.human, idents="CD4_Thymus"), cols.highlight="#e41a1c", cols="#d9d9d9", sizes.highlight = 0.1)+
  theme(legend.position="none")+
  ggtitle("Thymic CD4+ cells")
# CD8 Thymus
b <- DimPlot(seur.human, pt.size = 0.1, label = F, cells.highlight=WhichCells(seur.human, idents="CD8_Thymus"), cols.highlight="#377eb8", cols="#d9d9d9", sizes.highlight = 0.1)+
  theme(legend.position="none")+
  ggtitle("Thymic CD8+ cells")
# iNKT Thymus
c <- DimPlot(seur.human, pt.size = 0.1, label = F, cells.highlight=WhichCells(seur.human, idents="NKT_Thymus"), cols.highlight="#4daf4a", cols="#d9d9d9", sizes.highlight = 0.1)+
  theme(legend.position="none")+
  ggtitle("Thymic iNKT cells")
# MAIT Thymus
d <- DimPlot(seur.human, pt.size = 0.1, label = F, cells.highlight=WhichCells(seur.human, idents="MAIT_Thymus"), cols.highlight="#984ea3", cols="#d9d9d9", sizes.highlight = 0.1)+
  theme(legend.position="none")+
  ggtitle("Thymic MAIT cells")

ggpubr::ggarrange(a,b,c,d, ncol=2, nrow=2)
ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/00_HumanData/umap_all_SPthymocytes.jpeg", width=10, height=9)


# Color by cluster
DimPlot(seur.human, pt.size = 0.1, label = F, group.by="seurat_clusters") +
  theme_bw()
```


## 3. Create Shiny app

```{r create-shiny-app}
library(ShinyCell)


# Create shiny configuration
scConf = createConfig(seur.human)
makeShinyApp(seur.human, scConf, gene.mapping = FALSE,
             gex.assay="SCT", gex.slot="data",
             default.gene1="CD4",
             default.gene2="CD8A",
             shiny.title = "ShinyCell Gapin Human data",
             shiny.dir="shinyAppHumanGapinData/") 
```

