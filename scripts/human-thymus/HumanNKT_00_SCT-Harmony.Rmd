---
title: "Human iNKT data - Comparison of preprocessing methods"
output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
---

```{r, include=FALSE}
knitr::opts_chunk$set(root.dir = "~/Projects/20220809_Thymic-iNKT-CrossSpecies/scripts/")
```


## 1. Import

```{r import-librairies, message=FALSE}
# Libraries
library(ggplot2)
library(cowplot)
library(Seurat)
library(SeuratWrappers)
library(harmony)
library(Matrix)
library(tidyverse)
```

```{r import-data}
# Data (sorted human iNKT cells from 3 subjects)
path.plots <- "~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/00_Reproduce_UMAPs"
path.data <- "~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/raw_data/human_data"
human5 <- read.csv(file.path(path.data, "CUThy13_220225_SampleTag05_hs_NKT_RSEC_MolsPerCell.csv"), sep=",", header=T, skip=7) # 404 cells
human8 <- read.csv(file.path(path.data, "CUTHY11BDRscRNA_seq_091621_SampleTag08_hs_NKT_RSEC_MolsPerCell.csv"), sep=",", header=T, skip=8) # 1913 cells
human12 <- read.csv(file.path(path.data, "CUTHY12BDRscRNA_seq_211101_SampleTag12_hs_NKT_RSEC_MolsPerCell.csv"), sep=",", header=T, skip=8) # 344 cells

# Current df format:
# Rownames || Cell_Index | Gene1 | Gene2 | ...
#   -      ||   421953   |   0   |   0   | ...
#   -      ||   459121   |   0   |   3   | ...

# Invert the dataframes (cells as columns and genes as rows) and transform to dgCMatrix
convert_to_matrix <- function(df){
  rownames(df) <- df$Cell_Index
  df$Cell_Index <- NULL
  df <- t(df)
  df <- Matrix(df, sparse=T)
  return(df)
}

mat.hu5  <- convert_to_matrix(human5) # 404 cells
mat.hu8  <- convert_to_matrix(human8) # 1913 cells
mat.hu12 <- convert_to_matrix(human12) # 344 cells
```

## 2. Preprocessing

```{r create-seurat}
# Hu8_ is NKT_1_Thymus_
# Hu12_ is NKT_2_Thymus_
# Hu5_ is NKT_3_Thymus_

# Create Seurat Object, keep only features expressed in at least 1 cell
seur.h5  <- CreateSeuratObject(mat.hu5, project="NKT_3_Thymus", min.cells=1)
seur.h8  <- CreateSeuratObject(mat.hu8, project="NKT_1_Thymus", min.cells=1)
seur.h12 <- CreateSeuratObject(mat.hu12, project="NKT_2_Thymus", min.cells=1)

# Combine into one seurat object
seur.combined <- merge(seur.h5, y=c(seur.h8,seur.h12), add.cell.ids=c('NKT_3_Thymus', 'NKT_1_Thymus', 'NKT_2_Thymus'), project="HuNKT") # 2661 cells and 18,520 features
print(seur.combined)
```

```{r quality-control}
# QC
seur.combined[["percent.mt"]] <- PercentageFeatureSet(seur.combined, pattern = "^MT\\.")
head(seur.combined@meta.data, 5)
FeatureScatter(seur.combined, feature1 = "nCount_RNA", feature2 = "percent.mt")
FeatureScatter(seur.combined, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
VlnPlot(seur.combined, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3, pt.size=.01)
# ggsave(file.path(path.plots, "hu_qc.jpeg"), width=10, height=6)
seur.combined <- subset(seur.combined, subset = nFeature_RNA >= 500 & nFeature_RNA < 4000 & nCount_RNA >=500 & percent.mt < 25)
table(seur.combined@meta.data$orig.ident) # 399 cells hu5; 1828 cells hu8; 331 cells hu12

# See number of cells and features post-processing
print(seur.combined)
```

## 3. SCTransform and Harmony

Code combining SCTransform and Harmony based on this [forum discussion](https://github.com/immunogenomics/harmony/issues/41) and this [seurat tutorial](https://htmlpreview.github.io/?https://github.com/satijalab/seurat.wrappers/blob/master/docs/harmony.html)

```{r SCTransform1, message=F}
# Normalize with SCTransform and find variable features
seur.list <- SplitObject(seur.combined, split.by = "orig.ident")
seur.list <- lapply(X = seur.list, FUN = SCTransform) # weird, SCTransform adds features?!
sct.hvg   <- SelectIntegrationFeatures(object.list = seur.list, nfeatures = 2000)

# Merge back seurat objects to run Harmony afterwards
seur.SCT <- merge(seur.list$Hu_Thymus_NKT_5, y = c(seur.list$Hu_Thymus_NKT_8, seur.list$Hu_Thymus_NKT_12),
                      project = "HuNKT", merge.data = TRUE) # weird, now there are 30596 genes
VariableFeatures(seur.SCT) <- sct.hvg


# Run PCA (don't scale data when using SCTransform)
seur.SCT <- RunPCA(object = seur.SCT, assay = "SCT", npcs = 50, verbose=F)
DimPlot(seur.SCT, reduction = "pca", group.by = "orig.ident")
# ElbowPlot(seur.SCT)
```

```{r Harmony}
# Run Harmony for integration
seur.harmony <- RunHarmony(object = seur.SCT,
                           assay.use = "SCT",
                           reduction = "pca",
                           dims.use = 1:50,
                           group.by.vars = "orig.ident",
                           plot_convergence = F) # converged only after 2 iterations
seur.harmony <- RunUMAP(object = seur.harmony, assay = "SCT", reduction = "harmony", dims = 1:30, verbose=F)
seur.harmony <- FindNeighbors(object = seur.harmony, assay = "SCT", reduction = "harmony", dims = 1:30, verbose=F) %>%
  FindClusters(resolution = 0.8, verbose=F)


# First glance at UMAP
DimPlot(seur.harmony, pt.size = 0.1, label = T, label.size = 7) + ggtitle("SCTransform+Harmony") + theme(legend.position="none")
```

```{r SCTransform-Harmony-plot, fig.height=5, fig.width=15}
# Display UMAP
p1 <- DimPlot(seur.harmony, group.by = c("orig.ident"), pt.size = 0.1, label = F) + theme(legend.position="top", title = element_text(size=0))
p2 <- DimPlot(seur.harmony, pt.size = 0.1, label = TRUE) + labs(title="Integrated (2558 cells)") + theme(legend.position="none")
p3 <- DimPlot(seur.harmony, pt.size = 0.1, split.by = "orig.ident", ncol = 3)
ggdraw()+
  draw_plot(p1, x=0, y=0, width=.25, height=1)+
  draw_plot(p2, x=.25, y=0, width=.25, height=1)+
  draw_plot(p3, x=.5, y=0, width=.5, height=1)
```




## 4. LogNormalize and MNN

This workflow is the same used for the mouse NKT data.

```{r lognormalize-mnn}
# Normalize and find variable features
set.seed(123)
seur.mnn <- NormalizeData(seur.combined) # normalized data is saved in seur.combined[["RNA"]]@data
seur.mnn <- FindVariableFeatures(seur.mnn) # return 2,000 HVGs
# plot variable features with labels
LabelPoints(plot = VariableFeaturePlot(seur.mnn),
            points = head(VariableFeatures(seur.mnn), 10), repel = TRUE)
# ggsave(file.path(path.plots, "hu_hvg.jpeg"), width=8, height=6, bg="white")


# Run integration & dimension reduction
seur.mnn <- RunFastMNN(object.list = SplitObject(seur.mnn, split.by = "orig.ident"), k = 20, verbose=F)
seur.mnn <- RunUMAP(seur.mnn, reduction = "mnn", dims = 1:30, verbose=F)
seur.mnn <- FindNeighbors(seur.mnn, reduction = "mnn", dims = 1:30, compute.SNN = TRUE, verbose=F)
seur.mnn <- FindClusters(seur.mnn, resolution = 0.8, verbose=F)

# First glance at UMAP
DimPlot(seur.mnn, pt.size = 0.5, label = T, label.size = 7) + ggtitle("LogNormalize + fastMNN") + theme(legend.position="none")
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/04_HumanNKTdata/hu_inkt_umap_lognorm-mnn.jpeg", width=6, height=6)
```

```{r lognormalize-mnn-plot, fig.height=5, fig.width=15}
# Display UMAP
# ggsave("~/Downloads/hu_umap.jpeg", width=5, height=5)

p1 <- DimPlot(seur.mnn, group.by = c("orig.ident"), pt.size = 0.1, label = F) + theme(legend.position="top", title = element_text(size=0))
p2 <- DimPlot(seur.mnn, pt.size = 0.1, label = TRUE) + labs(title="Integrated (2558 cells)") + theme(legend.position="none")
p3 <- DimPlot(seur.mnn, pt.size = 0.1, split.by = "orig.ident", ncol = 3)

# jpeg(filename = file.path(path.plots, "hu_umap.jpeg"), width=5000, height=1500, res=300)
ggdraw()+
  draw_plot(p1, x=0, y=0, width=.25, height=1)+
  draw_plot(p2, x=.25, y=0, width=.25, height=1)+
  draw_plot(p3, x=.5, y=0, width=.5, height=1)

# PLZF expression
FeaturePlot(seur.mnn, features=c("CCR9", "CCR7","ZBTB16"), cols = c('#deebf7', 'red'), pt.size = 0.7, ncol=3)
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/04_HumanNKTdata/hu_inkt_features_lognorm-mnn.jpeg", width=16, height=5)
```


## 5. Compare methods

```{r merge-metadata}
# Rename cluster columns for merging downstream
head(seur.mnn@meta.data)
colnames(seur.mnn@meta.data)[6] <- "mnn_clusters"
head(seur.harmony@meta.data)
colnames(seur.harmony@meta.data)[8] <- "harmony_clusters"

# Merge the metadata df
metadata <- merge(seur.mnn@meta.data, seur.harmony@meta.data, by=c("row.names", "orig.ident", "nCount_RNA", "nFeature_RNA", "percent.mt"))
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL
head(metadata)

# Replace the metadata df in the seurat objects
seur.mnn@meta.data <- metadata
seur.harmony@meta.data <- metadata

# Sanity checks
DimPlot(seur.mnn, group.by="mnn_clusters", pt.size = 0.1, label = TRUE) + scale_color_brewer(palette="Set2")+ labs(title="LogNorm+MNN") + theme(legend.position="none")
DimPlot(seur.harmony, group.by="harmony_clusters", pt.size = 0.1, label = TRUE) + scale_color_brewer(palette="Paired")+ labs(title="SCT+Harmony") + theme(legend.position="none")
```

```{r cross-plot, fig.width=10, fig.height=10}
# Check which cluster corresponds to which across methods
mnn1 <- DimPlot(seur.mnn, group.by="mnn_clusters", pt.size = 0.1, label = TRUE) + scale_color_brewer(palette="Set2")+
  labs(title="LogNorm+MNN | Clust on MNN") + theme(legend.position="none")
mnn2 <- DimPlot(seur.mnn, group.by="harmony_clusters", pt.size = 0.1, label = TRUE) + scale_color_brewer(palette="Paired")+
  labs(title="LogNorm+MNN | Clust on Harmony") + theme(legend.position="none")
harm1 <- DimPlot(seur.harmony, group.by="harmony_clusters", pt.size = 0.1, label = TRUE) +scale_color_brewer(palette="Paired")+
  labs(title="SCT+Harmony | Clust on Harmony") + theme(legend.position="none")
harm2 <- DimPlot(seur.harmony, group.by="mnn_clusters", pt.size = 0.1, label = TRUE) + scale_color_brewer(palette="Set2")+
  labs(title="SCT+Harmony  | Clust on MNN") + theme(legend.position="none")

ggdraw()+
  draw_plot(mnn1, x=0,  y=.5, width=.5, height=.5)+
  draw_plot(mnn2, x=.5, y=.5, width=.5, height=.5)+
  draw_plot(harm2, x=0, y=0, width=.5, height=.5) +
  draw_plot(harm1, x=.5, y=0, width=.5, height=.5)
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/00_HumanData/salomecode_comparemethods.jpeg", width=9, height=8)
```

```{r key-genes, fig.width=7, fig.height=3}
# Function to look at genes of interest
plotFeatBoth <- function(gene){
  mnn <- FeaturePlot(seur.mnn, features=gene) +
    labs(title=gene)
  harm <- FeaturePlot(seur.harmony, features=gene) +
    labs(title=gene)
  # Plot both side-by-side
  mnn | harm
}

# Look at genes of interest (with MNN umap on the left, Harmony umap on the right)
genes.of.interest <- c("ZBTB16", "EOMES", "GZMK", "CCR7", "CCR9", "SELL", "PLAC8", "CD69", "CD4", "ISG15", "EGR2", "SLAMF1", "CD44", "NKG7", "KLRB1")
for (i in genes.of.interest){
  print(plotFeatBoth(i))
}
```




## 6. Laurent's code

#### a) Create seurat object

```{r create-seurat-only-shared-genes}
# Hu8_ is NKT_1_Thymus_
# Hu12_ is NKT_2_Thymus_
# Hu5_ is NKT_3_Thymus_

# Get the matrices into one list
all.data <- list("NKT_1_Thymus" = human8,
                 "NKT_2_Thymus" = human12,
                 "NKT_3_Thymus" = human5)

# Get sample names and gene names
shared_genes <- Reduce(intersect, lapply(X = all.data, FUN = function(x){ colnames(x) }))
shared_genes <- shared_genes[!shared_genes %in% 'Cell_Index']
sample.names <- names(all.data)


# Create seurat objects, keeping only genes present in all 3 individuals/datasets
all.seurat <- lapply(X = 1:length(all.data), FUN = function(x){
  sample.counts <- all.data[[x]]
  rownames(sample.counts) <- sample.counts$Cell_Index
  sample.counts$Cell_Index <- NULL
  transpose.df <- as.data.frame(t(as.matrix(sample.counts))) # have genes as rows, cells as cols
  transpose.df <- transpose.df[match(shared_genes, rownames(transpose.df)), ] # keep only genes present in all 3 individuals
  seurat.obj <- CreateSeuratObject(counts = transpose.df, project = sample.names[x])
})

# Merge into one seurat object
merged_seurat <- merge(x = all.seurat[[1]], y = all.seurat[2:length(all.seurat)],
                       add.cell.ids = sample.names, project = 'Human_Innate') # 2661 cells with 19,693 genes
print(merged_seurat)
```


#### b) Quality-control

```{r qc}
# Cell filtering
merged_seurat[["percent.mt"]] <- PercentageFeatureSet(merged_seurat, pattern = "^MT\\.")
VlnPlot(merged_seurat, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3, pt.size = 0)

filtered_seurat <- subset(merged_seurat, subset = nFeature_RNA >= 500 & nFeature_RNA < 4000 & nCount_RNA >=500 & percent.mt < 25) # 2558 cells
VlnPlot(filtered_seurat, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3, pt.size = 0)


# Keep only non-ribosomal-mt genes and genes that are present in at least 10 cells
counts <- GetAssayData(object = filtered_seurat, slot = "counts")
nonzero <- counts > 0
keep_genes <- Matrix::rowSums(nonzero) >= 10
genes.to.remove <- rownames(filtered_seurat)[grep(rownames(filtered_seurat), pattern = "^RPL|^RPS|^MT\\.")]
keep_genes[which(names(keep_genes) %in% genes.to.remove)] = FALSE
filtered_counts <- counts[keep_genes, ]

filtered_seurat <- CreateSeuratObject(filtered_counts, meta.data = filtered_seurat@meta.data) # 11,304 genes
print(filtered_seurat)
```


#### c) SCTransform and Harmony

```{r SCTransform}
# Import metadata
# sample_metadata <- read.csv(file = "/Volumes/Samsung_T5/Human_MAIT_NKT/Data/Metadata.csv") %>% 
#   dplyr::select(-sample.id, -X, -file)
# 
# rownames(sample_metadata) <- sample_metadata$orig.ident
# cell_metadata <- sample_metadata[filtered_seurat$orig.ident,]
# for(meta in names(cell_metadata)){
#   filtered_seurat[[meta]] <- cell_metadata[[meta]]
# }
# 
# filtered_seurat@meta.data


# Normalize with SCTransform
filtered_seurat <- NormalizeData(filtered_seurat) # why log-normalize before using SCT?...
filtered_seurat <- SCTransform(filtered_seurat, vars.to.regress = c('percent.mt'), 
                               verbose=F, method = "glmGamPoi")

# Run dimension reduction (linear & non-linear)
filtered_seurat <- RunPCA(filtered_seurat, verbose=F)
# ElbowPlot(filtered_seurat)
filtered_seurat <- RunUMAP(filtered_seurat, dims = 1:15, min.dist = 0.3, spread = 0.5, verbose=F)
filtered_seurat <- FindNeighbors(filtered_seurat, dims = 1:15, verbose=F)
filtered_seurat <- FindClusters(filtered_seurat, resolution = 0.7, verbose=F)


# Run integration with Harmony (from the SCTransform data)
set.seed(0229)

DefaultAssay(filtered_seurat) <- "SCT"
# filtered_seurat_Harmony <- RunHarmony(filtered_seurat, group.by.vars = c("Batch", "Method"), assay.use = "SCT",
filtered_seurat_Harmony <- RunHarmony(filtered_seurat,
                                      group.by.vars = c("orig.ident"),
                                      assay.use = "SCT",
                                      max.iter.harmony = 20) # 11 iterations
filtered_seurat_Harmony <- RunUMAP(filtered_seurat_Harmony, reduction = "harmony", dims = 1:15, verbose=F)
filtered_seurat_Harmony <- FindNeighbors(filtered_seurat_Harmony, reduction = "harmony", dims = 1:15, verbose=F)
filtered_seurat_Harmony <- FindClusters(filtered_seurat_Harmony, resolution = 0.5, verbose=F)

DimPlot(filtered_seurat_Harmony, group.by = c("seurat_clusters"),
              pt.size = 0.5, 
              ncol = 1, 
              label = TRUE, label.size = 6) + NoLegend()+
  scale_color_brewer(palette="Paired")
ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/04_HumanNKTdata/sctransform_harmony/hu_inkt_umap_sctransform-harmony.jpeg", width=6, height=6)


# PLZF expression
FeaturePlot(filtered_seurat_Harmony, features=c("CCR9", "CCR7","ZBTB16"), cols = c('#deebf7', 'red'), pt.size = 0.7, ncol=3)
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/04_HumanNKTdata/hu_inkt_features_sct-harmony.jpeg", width=16, height=5)

# Check out PCA and top genes
DimPlot(filtered_seurat_Harmony, reduction="harmony") + scale_color_brewer(palette="Paired")
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/04_HumanNKTdata/sctransform_harmony/hu_inkt_pca_sct-harmony.jpeg", width=7, height=6)
# Top features
DimHeatmap(filtered_seurat_Harmony, dims=1, reduction="harmony", balanced=T, nfeatures=30, fast=F)
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/04_HumanNKTdata/sctransform_harmony/hu_inkt_pca_topfeaturesPC1.jpeg", width=7, height=5)

FeaturePlot(filtered_seurat_Harmony, features=c("ITM2A", "SATB1","TOX2", "HIVEP3",
                                                "KLF2", "IL7R", "S100A4", "JUNB"), cols = c('#deebf7', 'red'), pt.size = 0.7, ncol=4)
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/04_HumanNKTdata/sctransform_harmony/hu_inkt_umap_topfeaturesPC1.jpeg", width=17, height=8)
```


#### d) LogNormalize and MNN

```{r mnn}
# Go back to the RNA assay that was lognormalized
DefaultAssay(filtered_seurat) <- "RNA"
filtered_seurat_MNN <- RunFastMNN(object.list = SplitObject(filtered_seurat, split.by = "orig.ident"), k = 20, 
                                  auto.merge = TRUE, verbose=F)
filtered_seurat_MNN <- RunUMAP(filtered_seurat_MNN, reduction = "mnn", dims = 1:15, verbose=F)
filtered_seurat_MNN <- FindNeighbors(filtered_seurat_MNN, reduction = "mnn", dims = 1:15, verbose=F)
filtered_seurat_MNN <- FindClusters(filtered_seurat_MNN, resolution = 0.5, verbose=F)

DimPlot(filtered_seurat_MNN, group.by = c("seurat_clusters"),
              pt.size = 1, 
              ncol = 1, 
              label = TRUE, label.size = 6) + NoLegend()
```


#### e) Compare methods

```{r compare-methods, fig.width=10, fig.height=10}
# Rename cluster columns for merging downstream
head(filtered_seurat_MNN@meta.data)
colnames(filtered_seurat_MNN@meta.data)[8] <- "mnn_clusters"
head(filtered_seurat_Harmony@meta.data)
colnames(filtered_seurat_Harmony@meta.data)[8] <- "harmony_clusters"

# Merge the metadata df
metadata <- merge(filtered_seurat_MNN@meta.data, filtered_seurat_Harmony@meta.data, by=c("row.names", "orig.ident"))
rownames(metadata) <- metadata$Row.names
metadata$Row.names <- NULL
head(metadata)

# Replace the metadata df in the seurat objects
filtered_seurat_MNN@meta.data <- metadata
filtered_seurat_Harmony@meta.data <- metadata

# Sanity checks
# DimPlot(filtered_seurat_MNN, group.by="mnn_clusters", pt.size = 0.1, label = TRUE) + labs(title="LogNorm+MNN") + theme(legend.position="none")
# DimPlot(filtered_seurat_Harmony, group.by="harmony_clusters", pt.size = 0.1, label = TRUE) + labs(title="SCT+Harmony") + theme(legend.position="none")

# Check which cluster corresponds to which across methods
mnn1 <- DimPlot(filtered_seurat_MNN, group.by="mnn_clusters", pt.size = 0.1, label = TRUE) +
  scale_color_brewer(palette="Set2")+
  labs(title="LogNorm+MNN | Clust on MNN") +
  theme(legend.position="none")
mnn2 <- DimPlot(filtered_seurat_MNN, group.by="harmony_clusters", pt.size = 0.1, label = TRUE) +
  scale_color_brewer(palette="Paired")+
  labs(title="LogNorm+MNN | Clust on Harmony") + theme(legend.position="none")
harm1 <- DimPlot(filtered_seurat_Harmony, group.by="harmony_clusters", pt.size = 0.1, label = TRUE) +
  scale_color_brewer(palette="Paired")+
  labs(title="SCT+Harmony | Clust on Harmony") + theme(legend.position="none")
harm2 <- DimPlot(filtered_seurat_Harmony, group.by="mnn_clusters", pt.size = 0.1, label = TRUE) +
  scale_color_brewer(palette="Set2") +
  labs(title="SCT+Harmony  | Clust on MNN") + theme(legend.position="none")

ggdraw()+
  draw_plot(mnn1, x=0,  y=.5, width=.5, height=.5)+
  draw_plot(mnn2, x=.5, y=.5, width=.5, height=.5)+
  draw_plot(harm2, x=0, y=0, width=.5, height=.5) +
  draw_plot(harm1, x=.5, y=0, width=.5, height=.5)
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/00_HumanData/laurentcode_comparemethods.jpeg", width=9, height=8)
```

```{r genes-of-interest, fig.width=7, fig.height=3}
# Function to look at genes of interest
plotFeat <- function(gene){
  mnn <- FeaturePlot(filtered_seurat_MNN, features=gene) +
    labs(title=gene)
  harm <- FeaturePlot(filtered_seurat_Harmony, features=gene) +
    labs(title=gene)
  # Plot both side-by-side
  mnn | harm
}

# Look at genes of interest (with MNN umap on the left, Harmony umap on the right)
for(i in genes.of.interest){
  print(plotFeat(i))
}

# Save feature plot
# FeaturePlot(filtered_seurat_MNN, features=c("ZBTB16", "EOMES", "GZMK", "CCR7", "CCR9", "SELL", "PLAC8", "CD69", "CD4", "ISG15"), cols = c('#deebf7', 'red'))
# ggsave("~/Projects/20220809_Thymic-iNKT-CrossSpecies/data/00_HumanData/lognorm-mnn_features.jpeg", width=18, height=12)

# Look at other genes
# plotFeat("MME")
```


#### f) Verify clustering stability with scClustEval

```{r check-clust-stability}

```

